<section class="page">
  <!-- Page Header -->
  <header class="page-header">
    <div>
      <h1 class="title">Service &amp; Finance Cockpit</h1>
      <p class="subtitle">Arbeitsvorräte, Klärfälle, offene Posten und operative Kennzahlen</p>
    </div>
  </header>

  <div class="grid">
    <!-- Card 1: KPIs (Kachel-Übersicht) -->
    <div class="card">
      <div class="card-header">
        <div>
          <div class="card-title">KPIs</div>
          <div class="card-subtitle">
            Operative Kennzahlen (täglich/rolling) für Service und Forderungsmanagement
          </div>
        </div>
      </div>

      <!-- KPI Grid -->
      <div class="kpi-grid">
        <div class="kpi card" *ngFor="let k of kpis">
          <div class="kpi-label">{{ k.label }}</div>
          <div class="kpi-value">{{ k.value }}</div>
          <div class="kpi-meta">{{ k.meta }}</div>
        </div>
      </div>
    </div>

    <!-- Card 2: Worklist (Tabelle) -->
    <div class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Worklist · Service / OP / Klärfälle</div>
          <div class="card-subtitle">Priorisierte Bearbeitungsliste (Auszug)</div>
        </div>
      </div>

      <!-- Worklist Tabelle -->
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>Fall-ID</th>
              <th>Referenz</th>
              <th>Betrag</th>
              <th>Überfällig</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let c of cases"
              (click)="selectCase(c)"
              [class.selected]="c.id === selectedCase?.id"
            >
              <td>{{ c.id }}</td>
              <td>{{ c.customerRef }}</td>
              <td>{{ c.amountEur.toFixed(2).replace('.', ',') }} €</td>
              <td>{{ c.overdueDays }} Tage</td>
              <td>
                <span
                  class="pill"
                  [class.pill-active]="isOpen(c)"
                  [class.pill-inactive]="!isOpen(c)"
                >
                  {{ c.status }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Hinweis -->
      <div class="section-title">Hinweis</div>
      <p class="section-hint">
        “Offen” = Bearbeitung/Einzug notwendig · “In Klärung” = z. B. Rechnung, Zuordnung oder
        Ratenplan wird geprüft
      </p>
    </div>

    <!-- Card 3: Vorgangsdetails (Detailkarte) -->
    <div class="card">
      <div class="card-header">
        <div *ngIf="selectedCase as sc; else loadingCase">
          <div class="card-title">Vorgangsdetails – {{ sc.id }}</div>
          <div class="card-subtitle">Zusammenfassung und nächster Schritt</div>
        </div>

        <!-- Loading State -->
        <ng-template #loadingCase>
          <div class="card-title">Vorgangsdetails</div>
          <div class="card-subtitle">Lade Daten…</div>
        </ng-template>
      </div>

      <ng-container *ngIf="selectedCase as sc">
        <!-- Section: Übersicht -->
        <div class="section-title">Übersicht</div>
        <p class="section-hint">Kurzsicht auf den ausgewählten Vorgang</p>

        <div class="details">
          <div class="detail">
            <div class="label">Referenz</div>
            <div class="value">{{ sc.customerRef }}</div>
          </div>

          <div class="detail">
            <div class="label">Betrag</div>
            <div class="value">{{ sc.amountEur.toFixed(2).replace('.', ',') }} €</div>
          </div>

          <div class="detail">
            <div class="label">Überfällig</div>
            <div class="value">{{ sc.overdueDays }} Tage</div>
          </div>

          <div class="detail">
            <div class="label">Status</div>
            <div class="value">{{ sc.status }}</div>
          </div>
        </div>

        <!-- Section: Nächster Schritt -->
        <div class="section-title">Nächster Schritt</div>
        <p class="section-hint">Operative Aktion / To-do</p>

        <div class="details">
          <div class="detail full">
            <div class="label">Empfehlung</div>
            <div class="value">{{ sc.nextStep }}</div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</section>
